
搭建一个支持百万用户并发聊天的消息系统
数据准备
    创建一百万个用户
    创建好友关系，每个用户随机连接一百名好友

    每个用户向他的好友发送消息,每2秒一条消息

监控的搭建
    能够观测到当前各个服务节点消息的发送数量
    能够监控到各个节点消息的堆积情况
    能够监控到请求延迟情况


存储的设计目标,
是百万用户同时在线聊天,按照28原则,那么日活在5百万,月活预期在1500万左右
每人每天平均聊天数量为15条,一个月的存储量,则大概在15 * 1500 = 22500万条,
一年的存储量则大概在12 * 22500 = 270000万条 = 27亿


256^3 ~= 17W 
256^4 = 2^32 = 4294967296 ~= 4.3亿
16777216

200 * 200 * 200 * 100 = 8亿
假设 100W TPS, 那么QPS大概在 800W,

聊天内容的存储放在机械硬盘,硬盘的考量则主要是在消息队列的泄洪时的持续写入上,把2小时的压力,均摊到20小时上,
redis 放版本号变动,和最近的聊天信息,redis的查询性能在10wQPS

8U16G内存的MBP上,性能大致是30wTPS

假设B+树4层高度
